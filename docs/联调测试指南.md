# 前后端联调测试指南

## 启动服务

### 1. 启动后端服务

```bash
cd backend
npm run dev
```

### 2. 启动前端服务

```bash
cd frontend
npm run dev
```

### 3. 启动后台管理

```bash
cd admin
npm run dev
```

## 新增功能测试点

### 一、优惠券管理（/coupons）

#### 测试接口

- `GET /api/admin/coupons` - 获取列表
- `POST /api/admin/coupons` - 创建优惠券
- `PUT /api/admin/coupons/:id` - 更新优惠券
- `DELETE /api/admin/coupons/:id` - 删除优惠券

#### 测试步骤

1. 登录后台管理系统
2. 点击左侧菜单"优惠券管理"
3. 点击"创建优惠券"按钮
4. 填写表单：
   - 优惠券名称：测试满减券
   - 优惠金额：50
   - 最低消费：299
   - 发放总量：1000
   - 有效期：选择时间范围
5. 点击创建，验证创建成功
6. 在列表中编辑、删除测试

#### 注意事项

- 优惠券状态会根据时间自动计算（未开始/进行中/已结束）
- 数据库字段为 `discountAmount`（前端传 amount）

### 二、Banner 管理（/banners）

#### 测试接口

- `GET /api/admin/banners` - 获取列表
- `POST /api/admin/banners` - 创建 Banner
- `PUT /api/admin/banners/:id` - 更新 Banner
- `DELETE /api/admin/banners/:id` - 删除 Banner

#### 测试步骤

1. 点击左侧菜单"Banner 管理"
2. 点击"添加 Banner"
3. 填写：
   - 标题：首页轮播图 1
   - 图片 URL：https://picsum.photos/800/400
   - 跳转链接：（可选）
   - 排序：0（数字越小越靠前）
   - 状态：启用
4. 保存后查看列表
5. 测试状态切换开关
6. 前端首页查看效果

#### 注意事项

- 数据库字段为 `sort`，前端显示为"排序"
- Banner 需要 `position` 字段（默认 HOME）

### 三、分类管理（/categories）

#### 测试接口

- `GET /api/admin/categories` - 获取全部分类
- `POST /api/admin/categories` - 创建分类
- `PUT /api/admin/categories/:id` - 更新分类
- `DELETE /api/admin/categories/:id` - 删除分类

#### 测试步骤

1. 点击左侧菜单"分类管理"
2. 点击"添加分类"创建顶级分类
3. 填写分类名称、图标 URL、排序
4. 点击某个分类的"添加子分类"创建二级分类
5. 测试树形结构展示
6. 删除测试（会递归删除子分类）

#### 注意事项

- 支持父子分类关系（二级分类）
- 删除父分类会同时删除所有子分类
- 数据库字段为 `sort`
- 显示商品数量统计

## 前端用户功能测试

### 前端页面功能增强

#### 1. 首页（/）

- ✅ 商品卡片新增"收藏"按钮（右上角心形图标）
- ✅ 商品卡片新增"加入购物车"按钮（底部）
- 测试收藏/取消收藏
- 测试加入购物车

#### 2. 发现页（/discover）

- ✅ 用户头像右侧"关注"按钮功能完整
- ✅ 商品区域"购买"按钮可跳转
- 测试关注/取消关注
- 测试点赞功能

#### 3. 秒杀页（/flash-sale）

- ✅ 商品卡片底部新增"立即抢购"按钮
- 点击后自动加入购物车并跳转

#### 4. 排行榜（/ranking）

- ✅ 每个商品新增"加购"按钮（底部）
- 测试快速加购功能

#### 5. 购物车（/cart）

- ✅ "猜你喜欢"商品新增"加购"按钮
- 测试推荐商品加购

#### 6. 优惠券中心（/coupon-center）

- ✅ 领取按钮改用 ElMessage 提示
- ✅ 集成真实 API（需后端支持）
- 测试优惠券领取

## API 验证工具

### Postman 测试集合

#### 优惠券 API

```
POST http://localhost:3000/api/admin/coupons
Headers: Authorization: Bearer {token}
Body:
{
  "name": "满减优惠券",
  "amount": 50,
  "minAmount": 299,
  "totalCount": 1000,
  "startTime": "2024-12-15T00:00:00Z",
  "endTime": "2024-12-31T23:59:59Z",
  "description": "全场可用"
}
```

#### Banner API

```
POST http://localhost:3000/api/admin/banners
Headers: Authorization: Bearer {token}
Body:
{
  "title": "首页轮播图",
  "image": "https://picsum.photos/800/400",
  "link": "",
  "sort": 0,
  "position": "HOME",
  "status": "ACTIVE"
}
```

#### 分类 API

```
POST http://localhost:3000/api/admin/categories
Headers: Authorization: Bearer {token}
Body:
{
  "name": "电子产品",
  "icon": "https://picsum.photos/100/100",
  "parentId": null,
  "sort": 0,
  "status": "ACTIVE"
}
```

## 常见问题

### 1. TypeScript 类型错误

后端 Service 层的部分 TypeScript 警告不影响运行，主要是 Prisma 生成的类型推断问题。

### 2. 字段名映射

- 前端使用 `sortOrder` / `amount`
- 数据库使用 `sort` / `discountAmount`
- Service 层已做转换

### 3. 图片显示问题

- 确保图片 URL 可访问
- 使用 https://picsum.photos 作为测试图片源
- ImageWithFallback 组件会处理加载失败的情况

### 4. 权限认证

- 后台管理需要 admin_token
- 前端用户功能需要 access_token
- 在 localStorage 中查看 token 状态

## 数据库迁移

如果需要重置数据库：

```bash
cd backend
npx prisma migrate reset
npx prisma db seed
```

## 测试账号

### 管理员账号

- 用户名：admin
- 密码：admin123

### 测试用户

查看 `backend/prisma/seed.ts` 中的测试用户信息

## 验收标准

✅ 后台管理三个新页面可正常访问
✅ 优惠券 CRUD 操作正常
✅ Banner CRUD 操作正常
✅ 分类 CRUD 操作正常（含树形结构）
✅ 前端 6 个页面的按钮功能完整
✅ 所有 API 返回正确的数据格式
✅ 错误提示使用 ElMessage 统一展示
