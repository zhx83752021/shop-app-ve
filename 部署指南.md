# 部署指南 - 修复页面数据为空问题

## 📦 Git 仓库信息

- **仓库地址**：https://github.com/zhx83752021/shop-app-ve.git
- **Vercel 域名**：
  - https://shop-app-ve.vercel.app
  - https://shop.hybergy.cn

## 🚀 快速部署流程

### 步骤 1：提交代码到 GitHub

在项目根目录执行以下命令：

```bash
# 检查当前状态
git status

# 添加所有修改的文件
git add .

# 提交更改
git commit -m "修复 Banner API 缺失导致页面数据为空的问题

- 新增 Banner Controller (backend/src/controllers/banner.controller.ts)
- 新增 Banner Routes (backend/src/routes/banner.routes.ts)
- 修复主路由配置 (backend/src/routes/index.ts)
- 修复数据库种子脚本 (backend/prisma/seed.ts)
- 创建快速 SQL 初始化脚本 (backend/prisma/quick-seed.sql)"

# 推送到 GitHub
git push origin main
```

如果推送失败，可能需要先拉取最新代码：

```bash
git pull origin main --rebase
git push origin main
```

### 步骤 2：等待 Vercel 自动部署

1. **访问 Vercel Dashboard**

   - https://vercel.com/dashboard

2. **查看部署状态**

   - 找到项目 `shop-app-ve`
   - 查看最新的部署记录
   - 等待构建完成（通常 2-5 分钟）

3. **部署成功标志**
   - 状态显示为 "Ready"
   - 可以看到新的部署 URL

### 步骤 3：初始化数据库数据（重要！）

由于数据库连接问题，需要在 Supabase 控制台手动执行 SQL：

1. **登录 Supabase**

   - 访问：https://supabase.com/dashboard
   - 选择你的项目

2. **打开 SQL 编辑器**

   - 左侧菜单点击 `SQL Editor`
   - 点击 `New query`

3. **执行初始化脚本**

   - 打开文件：`backend/prisma/quick-seed.sql`
   - 复制全部内容
   - 粘贴到 SQL 编辑器
   - 点击 `Run` 执行

4. **验证数据**
   - 查看执行结果，应显示：
     ```
     表名     | 记录数
     ---------|-------
     分类     | 5
     轮播图   | 3
     商品     | 12
     ```

### 步骤 4：验证修复结果

1. **测试 API 接口**

   ```bash
   # 测试 Banner API
   curl https://shop.hybergy.cn/api/banners

   # 测试 Product API
   curl https://shop.hybergy.cn/api/products?page=1&pageSize=20
   ```

2. **访问前端页面**

   - 打开：https://shop.hybergy.cn/home
   - 应该看到：
     - ✅ 轮播图正常显示（3 张）
     - ✅ 商品列表正常显示
     - ✅ "直播热卖" 模块有数据
     - ✅ "限时秒杀" 模块有数据
     - ✅ "为你推荐" 商品网格显示

3. **检查浏览器控制台**
   - 按 F12 打开开发者工具
   - 查看 Network 标签
   - 确认 `/api/banners` 和 `/api/products` 请求都返回 200 状态
   - 确认返回的数据格式正确

## 🔍 故障排查

### 问题 1：Git 推送失败

**错误信息**：`error: failed to push some refs`

**解决方案**：

```bash
git pull origin main --rebase
git push origin main
```

### 问题 2：Vercel 部署失败

**检查项**：

1. 访问 Vercel Dashboard 查看构建日志
2. 确认环境变量已正确配置：
   - `DATABASE_URL`: postgresql://postgres:SpoDa7qk1Y0DIfvU@db.xidbrgszgwrvqrpckjkw.supabase.co:5432/postgres
   - `JWT_SECRET`: dev-secret-key-change-in-production-2024
   - `REFRESH_TOKEN_SECRET`: dev-refresh-secret-key-2024

### 问题 3：页面仍显示"加载中..."

**排查步骤**：

1. 打开浏览器开发者工具（F12）
2. 查看 Network 标签
3. 检查 API 请求状态：
   - 如果请求失败（404/500），检查 Vercel 部署日志
   - 如果请求成功但无数据，检查数据库是否已初始化
4. 查看 Console 标签是否有错误信息

**解决方案**：

- 确保在 Supabase 控制台执行了 `quick-seed.sql`
- 清除浏览器缓存并刷新
- 等待 Vercel CDN 缓存更新（最多 5 分钟）

### 问题 4：API 返回 500 错误

**可能原因**：

- 数据库连接失败
- 环境变量配置错误

**解决方案**：

1. 检查 Vercel 环境变量配置
2. 在 Vercel Dashboard 重新部署项目
3. 查看 Vercel 运行时日志

## 📊 部署检查清单

- [ ] 代码已提交到 GitHub
- [ ] Vercel 自动部署成功
- [ ] Supabase 数据库已初始化（执行 SQL）
- [ ] Banner API 正常响应（/api/banners）
- [ ] Product API 正常响应（/api/products）
- [ ] 前端页面正常显示数据
- [ ] 浏览器控制台无错误
- [ ] 所有图片正常加载

## 🎯 预期结果

完成以上步骤后：

- ✅ https://shop.hybergy.cn/home 页面完全正常
- ✅ 轮播图自动切换
- ✅ 商品列表显示 12 个商品
- ✅ 所有模块都有真实数据
- ✅ 不再显示"加载中..."提示

## 💡 温馨提示

1. **首次部署**建议先在 Supabase 控制台执行 SQL 初始化数据
2. **每次代码更新**后 Vercel 会自动部署，无需手动操作
3. **数据库数据**只需初始化一次，后续部署会保留
4. **如遇问题**，优先检查浏览器控制台的网络请求
