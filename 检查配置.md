# Vercel 部署配置检查清单

## ✅ 必须完成的配置步骤

### 1. Vercel 环境变量配置

访问：https://vercel.com/dashboard → 选择项目 `shop-app-ve` → Settings → Environment Variables

**必须添加的环境变量**：

```
DATABASE_URL=postgresql://postgres:SpoDa7qk1Y0DIfvU@db.xidbrgszgwrvqrpckjkw.supabase.co:5432/postgres
```

**重要提示**：

- 所有环境（Production、Preview、Development）都要勾选
- 添加后必须重新部署才能生效

### 2. Supabase 数据库表创建

访问：https://supabase.com/dashboard → 选择项目 → SQL Editor

**执行脚本**：`完整建表脚本.sql`

**验证结果**：

```sql
-- 在 Supabase SQL Editor 中运行此查询，验证表是否创建成功
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
ORDER BY table_name;
```

**应该看到 21 个表**：

- admins
- addresses
- banners
- cart_items
- categories
- comments
- coupons
- favorites
- flash_sales
- orders
- order_items
- posts
- products
- rankings
- reviews
- skus
- system_configs
- user_coupons
- user_posts
- users
- video_records

### 3. 检查 Vercel 部署日志

1. 访问：https://vercel.com/dashboard
2. 选择项目 `shop-app-ve`
3. 点击 **Deployments**
4. 点击最新的部署
5. 查看 **Build Logs**

**查找关键日志**：

- ✅ "生成 Prisma Client" 成功
- ✅ "构建用户前端" 成功
- ✅ "构建后台管理" 成功
- ❌ 如果有错误，复制错误信息

### 4. 测试 API 端点

**方法 1：浏览器直接访问**

```
https://shop.hybergy.cn/api
```

应该返回：

```json
{
  "status": "success",
  "message": "API is running",
  "timestamp": "...",
  "database": "Connected"
}
```

**方法 2：测试具体接口**

```
https://shop.hybergy.cn/api/banners
https://shop.hybergy.cn/api/products
```

应该返回数据，而不是 500 错误。

### 5. 清除浏览器缓存

部署完成后：

1. 按 `Ctrl + Shift + Delete`
2. 选择"全部时间"
3. 清除缓存和 Cookie
4. 关闭浏览器重新打开
5. 访问：https://shop.hybergy.cn/home

---

## 🔧 故障排查

### 如果 API 返回 500 错误

**原因**：数据库连接失败或表不存在

**解决**：

1. 检查 Vercel 环境变量 `DATABASE_URL` 是否正确
2. 检查 Supabase 是否已执行建表脚本
3. 重新部署 Vercel 项目

### 如果页面显示"加载中..."

**原因**：前端无法获取 API 数据

**解决**：

1. 按 F12 打开浏览器控制台
2. 查看 Network 标签
3. 查看 /api/banners 和 /api/products 请求
4. 如果是 500 错误，按上面的步骤排查
5. 如果是 CORS 错误，检查后端 CORS 配置

### 如果构建失败

**原因**：依赖安装失败或编译错误

**解决**：

1. 查看 Vercel 构建日志
2. 确保 `package.json` 中的依赖版本正确
3. 确保 Node.js 版本 >= 20.x

---

## 📞 需要帮助？

如果以上步骤都完成了，但仍然有问题：

1. 截图 Vercel 环境变量配置页面
2. 截图 Vercel 最新部署的构建日志
3. 截图浏览器 F12 控制台的错误信息
4. 截图 Supabase 数据库表列表

这样我可以更准确地定位问题。
